<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Dashboard</title>
    <style>
        body {
            background: #0b0f19;
            color: white;
            font-family: Arial;
            padding: 20px;
            text-align: center;
        }
        .box {
            background: #111827;
            padding: 20px;
            margin: 20px auto;
            width: 350px;
            border-radius: 10px;
            box-shadow: 0 0 10px #00ff37;
        }
        input, button {
            width: 90%;
            padding: 10px;
            margin: 5px 0;
            border-radius: 6px;
            border: none;
        }
        button {
            background: #00ff37;
            font-weight: bold;
            cursor: pointer;
        }
        button:hover {
            opacity: 0.8;
        }
        hr {
            opacity: 0.3;
            margin: 20px 0;
        }
    </style>
</head>
<body>

    <h1>Admin Dashboard</h1>

    <!-- box -->
    <div class="box">

        <h3>Search User</h3>
        <input id="searchUser" placeholder="Username">
        <button onclick="loadUser()">Load User</button>

        <hr>

        <h3>User Data</h3>
        <p id="selectedUser">No user selected</p>
        <p id="balance">Balance: 0</p>

        <hr>

        <h3>Add Balance</h3>
        <input id="addAmount" type="number" placeholder="Amount">
        <button onclick="addBalance()">Add</button>

        <hr>

        <h3>Withdraw Balance</h3>
        <input id="withdrawAmount" type="number" placeholder="Amount">
        <button onclick="withdrawBalance()">Withdraw</button>

        <hr>

        <h3>Create Account</h3>
        <input id="newUser" placeholder="New Username">
        <input id="newPass" placeholder="New Password" type="password">
        <button onclick="createNewUser()" style="background:#ffaa00;">Create Account</button>

    </div>

<script>
// ---------------------------------------------------------------
//  JSONBIN SETTINGS — ضع هنا ال BIN ID و ال API KEY
// ---------------------------------------------------------------
const BIN_ID = "692eeefbae596e708f7e9e72";  // ← BIN ID
const API_KEY = "$2a$10$hCALb9EdUjLfi38M4RhCMOdm8.1y36yYtLvW0BYdZTfqjpHtlAY7S"; // ← KEY

// ---------------------------------------------------------------
//  جلب المستخدمين من JSONBin
// ---------------------------------------------------------------
async function getUsers() {
    const r = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, {
        headers: { "X-Master-Key": API_KEY }
    });
    const data = await r.json();
    return data.record;
}

// ---------------------------------------------------------------
//  حفظ المستخدمين في JSONBin
// ---------------------------------------------------------------
async function saveUsers(users) {
    await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
        method: "PUT",
        headers: {
            "X-Master-Key": API_KEY,
            "Content-Type": "application/json"
        },
        body: JSON.stringify(users)
    });
}

// ----------------------------
//  متغيرات
// ----------------------------
let currentUser = null;
let usersCache = {};

// ---------------------------------------------------------------
//  Load a specific user
// ---------------------------------------------------------------
async function loadUser() {
    const username = document.getElementById("searchUser").value.trim();

    if (!username) return alert("Enter username");

    const users = await getUsers();
    usersCache = users;

    if (!users[username]) {
        alert("User not found!");
        return;
    }

    currentUser = username;
    document.getElementById("selectedUser").innerText = "User: " + username;
    document.getElementById("balance").innerText = "Balance: " + users[username].balance;
}

// ---------------------------------------------------------------
//  Add Balance
// ---------------------------------------------------------------
async function addBalance() {
    if (!currentUser) return alert("Load a user first!");

    const amount = Number(document.getElementById("addAmount").value);
    if (amount <= 0) return alert("Invalid amount");

    usersCache[currentUser].balance += amount;

    await saveUsers(usersCache);

    document.getElementById("balance").innerText =
        "Balance: " + usersCache[currentUser].balance;

    alert("Balance added!");
}

// ---------------------------------------------------------------
//  Withdraw Balance
// ---------------------------------------------------------------
async function withdrawBalance() {
    if (!currentUser) return alert("Load a user first!");

    const amount = Number(document.getElementById("withdrawAmount").value);
    if (amount <= 0) return alert("Invalid amount");

    if (usersCache[currentUser].balance < amount)
        return alert("Not enough balance");

    usersCache[currentUser].balance -= amount;

    await saveUsers(usersCache);

    document.getElementById("balance").innerText =
        "Balance: " + usersCache[currentUser].balance;

    alert("Balance withdrawn!");
}

// ---------------------------------------------------------------
//  Create New User
// ---------------------------------------------------------------
async function createNewUser() {
    const u = document.getElementById("newUser").value.trim();
    const p = document.getElementById("newPass").value.trim();

    if (!u || !p) return alert("Fill all fields");

    const users = await getUsers();

    if (users[u]) {
        alert("Username already exists!");
        return;
    }

    users[u] = {
        password: p,
        balance: 0
    };

    await saveUsers(users);

    alert("Account created successfully!");
}
</script>

</body>
</html>
